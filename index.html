<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Analyse OP.GG - Team ennemie</title>
  <style>
    body {
      background-color: #0d0d12;
      font-family: Arial, sans-serif;
      color: #fff;
      padding: 20px;
    }
    h1 {
      color: #00bfff;
    }
    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      font-size: 14px;
      border: none;
    }
    button {
      padding: 10px 20px;
      background-color: #00bfff;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    .player {
      background-color: #1a1a1f;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
    }
    .champ {
      margin-left: 15px;
      color: #ccc;
    }
    .ban {
      color: #ff4d4d;
      font-weight: bold;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>Analyse OP.GG - Team ennemie</h1>
  <p>Colle les pseudos Riot (<em>ex: Durzat, Sabri, EnzoPATALO</em>)</p>
  <textarea id="summoners" placeholder="Durzat, Sabri, EnzoPATALO, ..."></textarea><br />
  <button onclick="analyser()">Analyser</button>

  <h2>Résultats</h2>
  <div id="results"></div>

  <script>
    async function analyser() {
      const input = document.getElementById("summoners").value;
      const names = input.split(",").map(n => n.trim()).filter(n => n.length > 0);

      if (!names.length) return alert("Ajoute au moins un pseudo Riot");

      const res = await fetch("/analyser", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ summoners: names })
      });

      const data = await res.json();
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (!data.players) {
        resultsDiv.innerHTML = "<p>❌ Erreur lors de l'analyse.</p>";
        return;
      }

      data.players.forEach(player => {
        const block = document.createElement("div");
        block.className = "player";

        const title = document.createElement("h3");
        title.textContent = player.summoner;
        block.appendChild(title);

        if (player.error) {
          const err = document.createElement("p");
          err.textContent = "❌ " + player.error;
          block.appendChild(err);
        } else if (!player.champions || player.champions.length === 0) {
          block.innerHTML += "<p>⚠️ Aucune donnée trouvée.</p>";
        } else {
          // Suggestion de ban = meilleur champion
          const best = player.champions[0];
          const ban = document.createElement("p");
          ban.className = "ban";
          ban.textContent = `➡️ Ban suggéré : ${best.champion} (${best.winrate}% winrate / ${best.games} games)`;
          block.appendChild(ban);

          player.champions.forEach(champ => {
            const line = document.createElement("div");
            line.className = "champ";
            line.textContent = `• ${champ.champion} - ${champ.games} games, ${champ.winrate}% winrate`;
            block.appendChild(line);
          });
        }

        resultsDiv.appendChild(block);
      });
    }
  </script>
</body>
</html>
